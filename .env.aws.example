# ========================================
# AWS NEPTUNE CONFIGURATION
# ========================================
# Copy this to .env.aws and run: source .env.aws

# AWS Region where Neptune cluster is located
export AWS_REGION=us-east-1

# Neptune Cluster Endpoint (from AWS Console)
# Format: your-cluster.xxxx.us-east-1.neptune.amazonaws.com
export NEPTUNE_ENDPOINT=your-neptune-cluster-endpoint

# GitHub Token (for repository analysis)
# Generate at: https://github.com/settings/tokens
export GITHUB_TOKEN=your_github_personal_access_token

# Webhook Secret (any secure random string)
export WEBHOOK_SECRET=your_secure_webhook_secret

# ========================================
# AWS SETUP INSTRUCTIONS
# ========================================

# 1. Create Neptune Cluster in AWS:
#    - Go to Amazon Neptune in AWS Console
#    - Create DB Cluster with serverless or provisioned instance
#    - Note the cluster endpoint (writer instance)
#    - Enable IAM authentication (recommended)

# 2. Configure Security Groups:
#    - Create security group for EKG services
#    - Allow inbound traffic on port 8182 (Neptune)
#    - Allow inbound traffic on ports 3000, 4000 (EKG services)
#    - Associate with Neptune cluster and ECS tasks

# 3. Set IAM Authentication:
#    - Enable IAM authentication on Neptune cluster
#    - Create ECS task role with neptune-db:Connect permission

# 4. ECS Deployment:
#    - Create ECS Task Execution Role
#      * Managed policy: AmazonECSTaskExecutionRolePolicy
#    - Create ECS Task Role
#      * Custom policy for Neptune access:
#        {
#          "Version": "2012-10-17",
#          "Statement": [{
#            "Effect": "Allow",
#            "Action": "neptune-db:Connect",
#            "Resource": "arn:aws:neptune-db:*:*:*"
#          }]
#        }

# 5. Deploy with Docker:
#    - Source environment variables
#    source .env.aws
#    - Run docker compose
#    docker compose -f docker-compose.ekg.yml up -d

# ========================================
# ENVIRONMENT VARIABLES REFERENCE
# ========================================

# EKG Ingestion Service (Port 3000)
# ----------------------------------
NODE_ENV=production
PORT=3000
WEBHOOK_SECRET=${WEBHOOK_SECRET}
NEPTUNE_ENDPOINT=${NEPTUNE_ENDPOINT}
NEPTUNE_PORT=8182
NEPTUNE_AUTH_MODE=IAM
AWS_REGION=${AWS_REGION}
GITHUB_TOKEN=${GITHUB_TOKEN}
SKIP_NEPTUNE=false
CORS_ORIGIN=*

# EKG Query Service (Port 4000)
# ----------------------------------
# PORT=4000
# NEPTUNE_ENDPOINT=${NEPTUNE_ENDPOINT}
# NEPTUNE_PORT=8182
# NEPTUNE_AUTH_MODE=IAM
# AWS_REGION=${AWS_REGION}
# SKIP_NEPTUNE=false
# CORS_ORIGIN=*
# INGESTION_SERVICE_URL=http://ekg-ingestion:3000

# ========================================
# ALTERNATIVE: Local Neptune (Docker)
# ========================================
# For local testing, you can use Gremlin server:
# docker run -p 8182:8182 tinkerpop/gremlin-server:3.7.1
# Then set:
# NEPTUNE_AUTH_MODE=
# SKIP_NEPTUNE=false
# NEPTUNE_ENDPOINT=host.docker.internal (Linux)
# NEPTUNE_ENDPOINT=host-gateway (Windows/Mac)

# ========================================
# VERIFICATION COMMANDS
# ========================================

# Check Neptune cluster status
aws neptune describe-db-instances --region us-east-1

# Test IAM authentication
aws neptune-db generate-db-auth-token --db-name your-cluster --region us-east-1 --username your-username

# Verify security group rules
aws ec2 describe-security-groups --group-names your-security-group --region us-east-1

# ECS Task status
aws ecs describe-tasks --cluster your-cluster --tasks your-task-arn --region us-east-1
